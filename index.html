<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JollyKite - –ö–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω üèÑ‚Äç‚ôÇÔ∏è</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="–ü—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞ –∏ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∫–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥–∞ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω, –¢–∞–∏–ª–∞–Ω–¥. –ñ–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–µ—Ç—Ä–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–≥–æ–¥–µ –¥–ª—è –∫–∞–π—Ç–µ—Ä–æ–≤.">
    <meta name="keywords" content="–∫–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥, –ø–∞–∫ –Ω–∞–º –ø—Ä–∞–Ω, —Ç–∞–∏–ª–∞–Ω–¥, –≤–µ—Ç–µ—Ä, –ø—Ä–æ–≥–Ω–æ–∑, kite, kitesurfing, wind forecast">
    <meta name="author" content="JollyKite">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Theme Colors -->
    <meta name="theme-color" content="#0ea5e9">
    <meta name="msapplication-TileColor" content="#1e293b">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png">
    
    <!-- Apple Mobile Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JollyKite">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    <meta name="msapplication-square70x70logo" content="/icons/icon-72x72.png">
    <meta name="msapplication-square150x150logo" content="/icons/icon-144x144.png">
    <meta name="msapplication-wide310x150logo" content="/icons/icon-384x384.png">
    <meta name="msapplication-square310x310logo" content="/icons/icon-384x384.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="JollyKite - –ö–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω">
    <meta property="og:description" content="–ü—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞ –∏ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∫–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥–∞ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω, –¢–∞–∏–ª–∞–Ω–¥">
    <meta property="og:image" content="/icons/icon-512x512.png">
    <meta property="og:url" content="https://jollykite.com">
    <meta property="og:site_name" content="JollyKite">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JollyKite - –ö–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω">
    <meta name="twitter:description" content="–ü—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞ –∏ —É—Å–ª–æ–≤–∏—è –¥–ª—è –∫–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥–∞ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω, –¢–∞–∏–ª–∞–Ω–¥">
    <meta name="twitter:image" content="/icons/icon-512x512.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Dancing+Script:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ocean': {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'dancing': ['Dancing Script', 'cursive'],
                        'pacifico': ['Pacifico', 'cursive']
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #2C5F7E 0%, #1E4A66 50%, #1A3A52 100%) !important;
            background-attachment: fixed !important;
            min-height: 100vh;
            color: #FFFFFF;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(180deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.03" d="M0,160L48,144C96,128,192,96,288,106.7C384,117,480,171,576,181.3C672,192,768,160,864,138.7C960,117,1056,107,1152,112C1248,117,1344,139,1392,149.3L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            background-position: bottom;
            opacity: 0.3;
            animation: waves 25s ease-in-out infinite;
            z-index: -2;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–π—Ç—ã –Ω–∞ —Ñ–æ–Ω–µ */
        .kite-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .flying-kite {
            position: absolute;
            opacity: 0.15;
        }

        .flying-kite svg {
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }

        .kite-1 {
            top: 10%;
            left: 10%;
            animation: floatKite1 30s ease-in-out infinite;
        }

        .kite-2 {
            top: 20%;
            right: 15%;
            animation: floatKite2 35s ease-in-out infinite;
            animation-delay: 5s;
        }

        .kite-3 {
            top: 5%;
            left: 50%;
            animation: floatKite3 40s ease-in-out infinite;
            animation-delay: 10s;
        }

        .kite-4 {
            bottom: 40%;
            right: 30%;
            animation: floatKite1 45s ease-in-out infinite;
            animation-delay: 15s;
        }

        .kite-5 {
            top: 35%;
            left: 25%;
            animation: floatKite2 38s ease-in-out infinite;
            animation-delay: 20s;
        }

        @keyframes floatKite1 {
            0%, 100% {
                transform: translate(0, 0) rotate(-5deg) scale(1);
            }
            25% {
                transform: translate(50px, -30px) rotate(5deg) scale(1.1);
            }
            50% {
                transform: translate(100px, 20px) rotate(-3deg) scale(0.95);
            }
            75% {
                transform: translate(30px, -20px) rotate(3deg) scale(1.05);
            }
        }

        @keyframes floatKite2 {
            0%, 100% {
                transform: translate(0, 0) rotate(3deg) scale(1);
            }
            25% {
                transform: translate(-40px, 40px) rotate(-8deg) scale(0.9);
            }
            50% {
                transform: translate(-80px, -30px) rotate(6deg) scale(1.15);
            }
            75% {
                transform: translate(-20px, 10px) rotate(-2deg) scale(1);
            }
        }

        @keyframes floatKite3 {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            33% {
                transform: translate(60px, 50px) rotate(10deg) scale(1.2);
            }
            66% {
                transform: translate(-40px, 30px) rotate(-7deg) scale(0.85);
            }
        }

        /* –û–±–ª–∞–∫–∞ */
        .cloud {
            position: absolute;
            opacity: 0.4;
            fill: white;
        }

        .cloud-1 {
            top: 15%;
            animation: drift 60s linear infinite;
        }

        .cloud-2 {
            top: 25%;
            animation: drift 80s linear infinite;
            animation-delay: 20s;
        }

        @keyframes drift {
            from {
                left: -200px;
            }
            to {
                left: 100%;
            }
        }

        @keyframes waves {
            0%, 100% { transform: translateY(0) scaleX(1); }
            50% { transform: translateY(-20px) scaleX(1.05); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 20px 30px;
            animation: fadeInDown 1s ease;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .site-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 700;
            background: linear-gradient(135deg, #00E0FF 0%, #157CFF 50%, #7C3AED 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
            margin: 0;
            padding: 10px 0;
            animation: shimmer 3s ease-in-out infinite;
            letter-spacing: 2px;
        }

        @keyframes shimmer {
            0%, 100% { 
                filter: brightness(1) drop-shadow(0 4px 8px rgba(0, 160, 255, 0.3)); 
            }
            50% { 
                filter: brightness(1.2) drop-shadow(0 4px 12px rgba(124, 58, 237, 0.4)); 
            }
        }


        .tagline {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-top: 10px;
            font-weight: 300;
        }

        .wind-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
            animation: fadeIn 1.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            background: rgba(255, 255, 255, 0.25);
        }

        .compass-card {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .compass-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 20px auto;
        }

        #windMap {
            height: 500px;
            width: 100%;
            border-radius: 15px;
            margin: 20px 0;
            z-index: 1;
        }

        .map-container {
            position: relative;
        }

        .wind-arrow-icon {
            transition: transform 1s ease-in-out;
        }


        /* –ï–¥–∏–Ω—ã–π –±–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ç—Ä–µ */
        .map-overlay-speed {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            min-width: 250px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .overlay-speed-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1A3A52;
            line-height: 1;
            text-align: center;
        }

        .overlay-speed-unit {
            font-size: 0.9rem;
            color: #333;
            text-align: center;
            margin-top: 5px;
        }

        .overlay-speed-condition {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            color: white;
            font-size: 0.9rem;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞ */
        .live-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.95);
            padding: 5px 15px;
            border-radius: 20px;
            z-index: 1001;
            font-size: 0.85rem;
            color: #1A3A52;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.6;
            }
        }

        .wind-speed-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .speed-value {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .speed-unit {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .wind-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }

        .detail-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .detail-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .detail-label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-value {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 2s ease;
        }

        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .price-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .price-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .price-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .price-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ffd700;
        }

        .telegram-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #00a8e8 0%, #0077be 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 168, 232, 0.3);
            margin: 20px 0;
        }

        .telegram-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 168, 232, 0.5);
        }


        footer {
            text-align: center;
            padding: 30px 20px;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .wind-dashboard {
                grid-template-columns: 1fr;
            }

            /* –°–¥–≤–∏–≥ –∫–∞—Ä—Ç—ã –≤–ª–µ–≤–æ –Ω–∞ 25% –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .card {
                overflow-x: hidden;
            }

            .map-container {
                margin-left: -25%;
                width: 150%;
            }

            #windMap {
                width: 100%;
            }

            .compass-container {
                width: 200px;
                height: 200px;
            }

            .price-grid {
                grid-template-columns: 1fr;
            }

            .forecast-slider {
                padding: 20px 10px 10px;
                min-height: 120px;
            }

            .forecast-hour-slot {
                min-width: 45px;
                padding: 6px 1px;
            }

            .forecast-hour-time {
                font-size: 0.65rem;
            }

            .forecast-hour-wind-icon {
                font-size: 1rem;
            }

            .forecast-hour-speed {
                font-size: 0.75rem;
            }

            .forecast-hour-dir {
                font-size: 0.6rem;
            }
        }

        .wind-condition {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .condition-perfect { background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); }
        .condition-good { background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); }
        .condition-light { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .condition-no-wind { background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); }

        .wind-description-block {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px 40px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            animation: pulseGlow 3s ease-in-out infinite;
        }

        .wind-description-icon {
            font-size: 3rem;
            animation: bounce 2s ease-in-out infinite;
        }

        .wind-description-text {
            text-align: left;
            flex: 1;
        }

        .wind-description-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #e0f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .wind-description-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0%, 100% { 
                filter: brightness(1) drop-shadow(0 4px 8px rgba(0, 160, 255, 0.3)); 
            }
            50% { 
                filter: brightness(1.2) drop-shadow(0 4px 12px rgba(124, 58, 237, 0.4)); 
            }
        }

        .animate-fadeInDown {
            animation: fadeInDown 1s ease;
        }

        .animate-shimmer {
            animation: shimmer 3s ease-in-out infinite;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–µ–ª–∫–∏ –≤–µ—Ç—Ä–∞ */
        .wind-arrow-container {
            pointer-events: none;
        }

        @keyframes arrowPulse {
            0%, 100% { 
                opacity: 0.9;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.05);
            }
        }

        @keyframes windParticle {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤–µ—Ç—Ä–∞ */
        .forecast-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 20px 15px;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 2s ease;
        }

        .forecast-slider {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px 15px 15px;
            margin-top: 15px;
            overflow-x: auto;
            overflow-y: hidden;
            min-height: 140px;
        }

        .forecast-timeline {
            display: flex;
            min-width: 100%;
            height: 100px;
            position: relative;
            gap: 2px;
        }

        .forecast-hour-slot {
            flex: 1;
            min-width: 60px;
            position: relative;
            border-radius: 8px;
            margin: 0 1px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .forecast-hour-slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .forecast-hour-time {
            font-size: 0.75rem;
            font-weight: 600;
            color: #FFFFFF;
            text-align: center;
            margin-bottom: 5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .forecast-hour-wind-icon {
            font-size: 1.2rem;
            text-align: center;
            margin: 3px 0;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }

        .forecast-hour-speed {
            font-size: 0.85rem;
            font-weight: 700;
            color: #FFFFFF;
            text-align: center;
            margin: 2px 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .forecast-hour-dir {
            font-size: 0.7rem;
            color: #FFFFFF;
            text-align: center;
            opacity: 0.9;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ —Å–∏–ª–µ –≤–µ—Ç—Ä–∞ */
        .wind-calm {
            background: linear-gradient(180deg, #9CA3AF 0%, #6B7280 100%);
        }

        .wind-light {
            background: linear-gradient(180deg, #34D399 0%, #10B981 100%);
        }

        .wind-moderate {
            background: linear-gradient(180deg, #60A5FA 0%, #3B82F6 100%);
        }

        .wind-fresh {
            background: linear-gradient(180deg, #FBBF24 0%, #F59E0B 100%);
        }

        .wind-strong {
            background: linear-gradient(180deg, #F87171 0%, #EF4444 100%);
        }

        .wind-gale {
            background: linear-gradient(180deg, #A855F7 0%, #9333EA 100%);
        }

        .forecast-loading {
            text-align: center;
            padding: 30px;
        }

        .forecast-details {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 15px -5px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .forecast-details.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .forecast-hours {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(65px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .forecast-hour {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 4px;
            text-align: center;
            font-size: 0.75rem;
        }

        .forecast-hour-time {
            font-weight: 600;
            margin-bottom: 5px;
            color: #87CEEB;
        }

        .forecast-hour-wind {
            color: #ffffff;
            font-weight: 500;
        }

        .forecast-hour-dir {
            opacity: 0.7;
            font-size: 0.7rem;
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω —Å –∫–∞–π—Ç–∞–º–∏ -->
    <div class="kite-background">
        <!-- –û–±–ª–∞–∫–∞ -->
        <svg class="cloud cloud-1" width="100" height="60" viewBox="0 0 100 60">
            <ellipse cx="25" cy="35" rx="25" ry="20"/>
            <ellipse cx="45" cy="30" rx="30" ry="25"/>
            <ellipse cx="70" cy="35" rx="25" ry="20"/>
        </svg>
        <svg class="cloud cloud-2" width="120" height="70" viewBox="0 0 120 70">
            <ellipse cx="30" cy="40" rx="30" ry="25"/>
            <ellipse cx="60" cy="35" rx="35" ry="30"/>
            <ellipse cx="90" cy="40" rx="28" ry="23"/>
        </svg>

        <!-- –õ–µ—Ç–∞—é—â–∏–µ –∫–∞–π—Ç—ã -->
        <div class="flying-kite kite-1">
            <svg width="100" height="100" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="kite1Grad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FF8E53;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M50,10 Q70,30 50,50 Q30,30 50,10" fill="url(#kite1Grad)"/>
                <path d="M50,50 Q55,70 50,90" stroke="#333" stroke-width="1" fill="none" opacity="0.3"/>
                <path d="M45,85 Q50,87 55,85" stroke="#333" stroke-width="0.5" fill="none" opacity="0.3"/>
            </svg>
        </div>

        <div class="flying-kite kite-2">
            <svg width="110" height="110" viewBox="0 0 110 110">
                <defs>
                    <linearGradient id="kite2Grad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#4ECDC4;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#44A08D;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M55,15 Q75,35 55,55 Q35,35 55,15" fill="url(#kite2Grad)"/>
                <path d="M55,55 Q60,75 55,95" stroke="#333" stroke-width="1" fill="none" opacity="0.3"/>
            </svg>
        </div>

        <div class="flying-kite kite-3">
            <svg width="90" height="90" viewBox="0 0 90 90">
                <defs>
                    <linearGradient id="kite3Grad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667EEA;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#764BA2;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M45,8 Q65,28 45,45 Q25,28 45,8" fill="url(#kite3Grad)"/>
                <path d="M45,45 Q48,65 45,85" stroke="#333" stroke-width="1" fill="none" opacity="0.3"/>
            </svg>
        </div>

        <div class="flying-kite kite-4">
            <svg width="95" height="95" viewBox="0 0 95 95">
                <defs>
                    <linearGradient id="kite4Grad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#F093FB;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#F5576C;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M47.5,12 Q67,32 47.5,50 Q28,32 47.5,12" fill="url(#kite4Grad)"/>
                <path d="M47.5,50 Q52,70 47.5,90" stroke="#333" stroke-width="1" fill="none" opacity="0.3"/>
            </svg>
        </div>

        <div class="flying-kite kite-5">
            <svg width="105" height="105" viewBox="0 0 105 105">
                <defs>
                    <linearGradient id="kite5Grad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FDBB2D;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#22C1C3;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M52.5,13 Q72,33 52.5,52 Q33,33 52.5,13" fill="url(#kite5Grad)"/>
                <path d="M52.5,52 Q57,72 52.5,92" stroke="#333" stroke-width="1" fill="none" opacity="0.3"/>
            </svg>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <header class="text-center py-8 sm:py-12 animate-fadeInDown">
            <h1 class="font-dancing text-5xl sm:text-6xl lg:text-7xl font-bold bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent drop-shadow-lg mb-4 tracking-wide animate-shimmer">
                JollyKite
            </h1>
            <p class="text-white/95 text-lg sm:text-xl font-light">–ö–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥ –≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω üèÑ‚Äç‚ôÇÔ∏è</p>
        </header>

        <div class="wind-dashboard">
            <!-- –ï–¥–∏–Ω—ã–π –±–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ç—Ä–µ (–ø–µ—Ä–µ–º–µ—â—ë–Ω –Ω–∞–¥ –∫–∞—Ä—Ç–æ–π) -->
            <div class="card" style="margin-bottom: 15px;">
                <div class="map-overlay-speed" style="position: relative; top: auto; left: auto;">
                        <div style="text-align: center; margin-bottom: 10px;">
                            <div style="font-size: 0.85rem; color: #666; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">–°–∏–ª–∞ –≤–µ—Ç—Ä–∞</div>
                            <div class="overlay-speed-value" id="windSpeed">--</div>
                            <div class="overlay-speed-unit">—É–∑–ª–æ–≤</div>
                            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 10px; font-size: 0.8rem;">
                                <div style="text-align: center;">
                                    <div style="color: #555; text-transform: uppercase; font-size: 0.7rem;">–ü–æ—Ä—ã–≤—ã</div>
                                    <div id="windGust" style="color: #333; font-weight: 600;">--</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #555; text-transform: uppercase; font-size: 0.7rem;">–ú–∞–∫—Å —Å–µ–≥–æ–¥–Ω—è</div>
                                    <div id="maxGust" style="color: #333; font-weight: 600;">--</div>
                                </div>
                            </div>
                            <!-- –¢—Ä–µ–Ω–¥ –≤–µ—Ç—Ä–∞ -->
                            <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.8); border-radius: 8px; text-align: center;">
                                <div style="color: #555; text-transform: uppercase; font-size: 0.7rem; margin-bottom: 5px;">–¢—Ä–µ–Ω–¥</div>
                                <div id="windTrend" style="color: #808080; font-weight: 600; font-size: 0.9rem;">
                                    <span style="font-size: 1.5em;">‚è≥</span>
                                    <span style="margin-left: 5px; font-weight: bold;">–ù–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); text-align: center;">
                            <div style="font-size: 0.85rem; color: #666; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞</div>
                            <div style="display: flex; align-items: center; justify-content: center;">
                                <span id="windCardinal" style="font-size: 1.8rem; font-weight: 700; color: #1A3A52;">–°</span>
                            </div>
                            <div id="windSafety" style="font-size: 0.9rem; font-weight: 600; color: #fff; margin-top: 8px;">--</div>
                            <div id="windSafetyDesc" style="font-size: 0.75rem; color: #888; margin-top: 3px;">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="card" style="padding: 0; overflow: hidden;">
                <div class="map-container">
                    <div id="windMap"></div>
                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç—Ä–µ–ª–∫–∏ –≤–µ—Ç—Ä–∞ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ Leaflet –º–∞—Ä–∫–µ—Ä -->

                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä LIVE —Å —Ç–∞–π–º–µ—Ä–æ–º -->
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        <span>LIVE</span>
                        <span id="updateCountdown" style="margin-left: 5px; font-size: 0.8em; opacity: 0.8;">15—Å</span>
                    </div>
                </div>
            </div>

            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–µ—Ç—Ä–∞ –ø–æ–¥ –∫–∞—Ä—Ç–æ–π -->
        <div style="text-align: center; margin: 40px 0;">
            <div id="windDescriptionButton" class="wind-description-block">
                <div class="wind-description-icon" id="windIcon">üçÉ</div>
                <div class="wind-description-text">
                    <div class="wind-description-title" id="windTitle">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...</div>
                    <div class="wind-description-subtitle" id="windSubtitle">–ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ</div>
                </div>
            </div>
        </div>

        <!-- –°–∏–º—É–ª—è—Ç–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤–µ—Ç—Ä–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ -->
        <div style="text-align: center; margin: 20px 0; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
            <h3 style="margin-bottom: 15px;">üîß –°–∏–º—É–ª—è—Ç–æ—Ä –≤–µ—Ç—Ä–∞ (–æ—Ç–ª–∞–¥–∫–∞)</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button onclick="simulateWind(0, 15)" style="padding: 8px 12px; border-radius: 8px; background: #f59e0b; color: white; border: none; cursor: pointer;">–° (0¬∞) üåä</button>
                <button onclick="simulateWind(45, 15)" style="padding: 8px 12px; border-radius: 8px; background: #10b981; color: white; border: none; cursor: pointer;">–°–í (45¬∞) ‚úÖ</button>
                <button onclick="simulateWind(90, 15)" style="padding: 8px 12px; border-radius: 8px; background: #059669; color: white; border: none; cursor: pointer;">–í (90¬∞) ‚úÖ</button>
                <button onclick="simulateWind(135, 15)" style="padding: 8px 12px; border-radius: 8px; background: #10b981; color: white; border: none; cursor: pointer;">–Æ–í (135¬∞) ‚úÖ</button>
                <button onclick="simulateWind(180, 15)" style="padding: 8px 12px; border-radius: 8px; background: #f59e0b; color: white; border: none; cursor: pointer;">–Æ (180¬∞) üåä</button>
                <button onclick="simulateWind(225, 15)" style="padding: 8px 12px; border-radius: 8px; background: #dc2626; color: white; border: none; cursor: pointer;">–Æ–ó (225¬∞) ‚ö†Ô∏è</button>
                <button onclick="simulateWind(270, 15)" style="padding: 8px 12px; border-radius: 8px; background: #b91c1c; color: white; border: none; cursor: pointer;">–ó (270¬∞) ‚ö†Ô∏è</button>
                <button onclick="simulateWind(315, 15)" style="padding: 8px 12px; border-radius: 8px; background: #dc2626; color: white; border: none; cursor: pointer;">–°–ó (315¬∞) ‚ö†Ô∏è</button>
            </div>
            <div id="debugInfo" style="margin-top: 15px; font-family: monospace; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; font-size: 0.9rem;">
                –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: -- | –°—Ç—Ä–µ–ª–∫–∞: -- | –ü–æ–∑–∏—Ü–∏—è: [--]
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Å—à—Ç–∞–±–∞ –∫–∞—Ä—Ç—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
        <div style="text-align: center; margin: 20px 0; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
            <h3 style="margin-bottom: 15px;">üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ä—Ç—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (–æ—Ç–ª–∞–¥–∫–∞)</h3>
            <p style="font-size: 0.85rem; margin-bottom: 15px; opacity: 0.8;">–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —ç–∫—Ä–∞–Ω–∞—Ö –¥–æ 768px —à–∏—Ä–∏–Ω—ã</p>

            <div style="max-width: 400px; margin: 0 auto;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 0.9rem; margin-bottom: 5px;">–ú–∞—Å—à—Ç–∞–± –∫–∞—Ä—Ç—ã (%):</label>
                    <input type="range" id="mapScaleInput" min="100" max="200" value="150" step="10"
                           style="width: 100%;" oninput="updateMapScale(this.value)">
                    <div style="font-size: 0.85rem; margin-top: 5px;">
                        <span id="mapScaleValue">150</span>%
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 0.9rem; margin-bottom: 5px;">–°–¥–≤–∏–≥ –≤–ª–µ–≤–æ (%):</label>
                    <input type="range" id="mapShiftInput" min="0" max="50" value="25" step="5"
                           style="width: 100%;" oninput="updateMapShift(this.value)">
                    <div style="font-size: 0.85rem; margin-top: 5px;">
                        <span id="mapShiftValue">25</span>%
                    </div>
                </div>

                <button onclick="applyMapSettings()"
                        style="margin-top: 10px; padding: 10px 20px; border-radius: 8px; background: #3b82f6; color: white; border: none; cursor: pointer; font-weight: bold;">
                    ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å CSS
                </button>

                <div id="mapSettingsCode" style="margin-top: 15px; display: none; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 8px; text-align: left; font-family: monospace; font-size: 0.8rem; overflow-x: auto;">
                </div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–º–µ—â–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∏ -->
        <div style="text-align: center; margin: 20px 0; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
            <h3 style="margin-bottom: 15px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç—Ä–µ–ª–∫–∏</h3>

            <!-- –û–±—â–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —É–≥–ª–∞ -->
            <div style="background: rgba(138,43,226,0.1); padding: 15px; border-radius: 10px; border: 2px solid #8b5cf6; max-width: 400px; margin: 0 auto 20px;">
                <h4 style="color: #8b5cf6; margin-bottom: 10px;">üß≠ –û–±—â–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —É–≥–ª–∞</h4>
                <p style="font-size: 0.85rem; margin-bottom: 10px; opacity: 0.8;">–ü–æ–≤–æ—Ä–æ—Ç –≤—Å–µ—Ö —Å—Ç—Ä–µ–ª–æ–∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–µ—Ä–µ–≥–∞</p>
                <div>
                    <label style="display: block; font-size: 0.9rem; margin-bottom: 3px;">–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —É–≥–ª–∞ (–≥—Ä–∞–¥—É—Å—ã):</label>
                    <input type="number" id="globalAngleOffset" step="1" value="0" min="-180" max="180" oninput="applyArrowOffsets()"
                           style="width: 100%; padding: 8px; border-radius: 5px; background: rgba(0,0,0,0.3); border: 1px solid #8b5cf6; color: white; text-align: center; font-size: 1.1rem;">
                    <p style="font-size: 0.75rem; margin-top: 5px; opacity: 0.7;">–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è - –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ</p>
                </div>
            </div>

            <h4 style="margin-bottom: 15px; color: #94a3b8;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; max-width: 1200px; margin: 0 auto;">

                <!-- –° (0¬∞) -->
                <div style="background: rgba(135,206,250,0.15); padding: 12px; border-radius: 8px; border: 2px solid #60a5fa;">
                    <h4 style="color: #60a5fa; margin-bottom: 8px; font-size: 0.95rem;">‚¨ÜÔ∏è –° (0¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir0OffsetX" step="0.0001" value="-0.0043" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #60a5fa; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir0OffsetY" step="0.0001" value="0.0006" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #60a5fa; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –°–í (45¬∞) -->
                <div style="background: rgba(16,185,129,0.15); padding: 12px; border-radius: 8px; border: 2px solid #10b981;">
                    <h4 style="color: #10b981; margin-bottom: 8px; font-size: 0.95rem;">‚ÜóÔ∏è –°–í (45¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir45OffsetX" step="0.0001" value="-0.0033" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #10b981; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir45OffsetY" step="0.0001" value="-0.0037" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #10b981; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –í (90¬∞) -->
                <div style="background: rgba(16,185,129,0.15); padding: 12px; border-radius: 8px; border: 2px solid #10b981;">
                    <h4 style="color: #10b981; margin-bottom: 8px; font-size: 0.95rem;">‚û°Ô∏è –í (90¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir90OffsetX" step="0.0001" value="-0.0004" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #10b981; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir90OffsetY" step="0.0001" value="-0.0041" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #10b981; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –Æ–í (135¬∞) -->
                <div style="background: rgba(16,185,129,0.15); padding: 12px; border-radius: 8px; border: 2px solid #10b981;">
                    <h4 style="color: #10b981; margin-bottom: 8px; font-size: 0.95rem;">‚ÜòÔ∏è –Æ–í (135¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir135OffsetX" step="0.0001" value="0.004" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #10b981; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir135OffsetY" step="0.0001" value="-0.0037" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #10b981; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –Æ (180¬∞) -->
                <div style="background: rgba(245,158,11,0.15); padding: 12px; border-radius: 8px; border: 2px solid #f59e0b;">
                    <h4 style="color: #f59e0b; margin-bottom: 8px; font-size: 0.95rem;">‚¨áÔ∏è –Æ (180¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir180OffsetX" step="0.0001" value="0.003" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #f59e0b; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir180OffsetY" step="0.0001" value="0.0011" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #f59e0b; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –Æ–ó (225¬∞) -->
                <div style="background: rgba(220,38,38,0.15); padding: 12px; border-radius: 8px; border: 2px solid #dc2626;">
                    <h4 style="color: #dc2626; margin-bottom: 8px; font-size: 0.95rem;">‚ÜôÔ∏è –Æ–ó (225¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir225OffsetX" step="0.0001" value="0.0025" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #dc2626; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir225OffsetY" step="0.0001" value="0.0045" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #dc2626; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –ó (270¬∞) -->
                <div style="background: rgba(220,38,38,0.15); padding: 12px; border-radius: 8px; border: 2px solid #dc2626;">
                    <h4 style="color: #dc2626; margin-bottom: 8px; font-size: 0.95rem;">‚¨ÖÔ∏è –ó (270¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir270OffsetX" step="0.0001" value="-0.0006" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #dc2626; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir270OffsetY" step="0.0001" value="0.004" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #dc2626; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

                <!-- –°–ó (315¬∞) -->
                <div style="background: rgba(220,38,38,0.15); padding: 12px; border-radius: 8px; border: 2px solid #dc2626;">
                    <h4 style="color: #dc2626; margin-bottom: 8px; font-size: 0.95rem;">‚ÜñÔ∏è –°–ó (315¬∞)</h4>
                    <div style="display: flex; gap: 8px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">X:</label>
                            <input type="number" id="dir315OffsetX" step="0.0001" value="-0.0034" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #dc2626; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.8rem; margin-bottom: 2px;">Y:</label>
                            <input type="number" id="dir315OffsetY" step="0.0001" value="0.004" oninput="applyArrowOffsets()"
                                   style="width: 100%; padding: 4px; border-radius: 4px; background: rgba(0,0,0,0.3); border: 1px solid #dc2626; color: white; text-align: center; font-size: 0.85rem;">
                        </div>
                    </div>
                </div>

            </div>
            <button onclick="applyArrowOffsets()" style="margin-top: 15px; padding: 10px 20px; border-radius: 8px; background: #3b82f6; color: white; border: none; cursor: pointer; font-weight: bold;">
                ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </div>

        <!-- –ë–ª–æ–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤–µ—Ç—Ä–∞ -->
        <div class="bg-white/15 backdrop-blur-md rounded-2xl p-6 my-8 border border-white/20 animate-fadeIn">
            <h2 class="text-center text-2xl font-semibold text-white mb-6">
                üå™Ô∏è –ü—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞ –Ω–∞ 3 –¥–Ω—è
            </h2>
            <div id="windForecast" class="bg-white/10 rounded-xl p-6 overflow-x-auto min-h-[150px]">
                <div class="text-center py-8">
                    <div class="inline-block w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin mb-3"></div>
                    <p class="text-white/80">–ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞...</p>
                </div>
            </div>
        </div>





        <!-- –ë–ª–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ -->
        <div class="text-center my-12">
            <h3 class="text-white text-2xl font-semibold mb-6">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É!</h3>
            <a href="https://t.me/gypsy_mermaid" class="inline-flex items-center gap-3 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white px-8 py-4 rounded-full text-lg font-semibold transition-all duration-300 hover:-translate-y-1 shadow-lg hover:shadow-xl">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.828.941z" fill="white"/>
                </svg>
                –°–≤—è–∑–∞—Ç—å—Å—è —Å @gypsy_mermaid
            </a>
        </div>

        <footer class="text-center py-8 text-white/80">
            <p class="text-sm">¬© 2024 JollyKite | –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥</p>
            <p class="text-sm mt-2 text-white/60">–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –∫–∞–π—Ç–µ—Ä–æ–≤ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω–∞</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script>
        // WindDataManager Class
        class WindDataManager {
            constructor() {
                this.apiUrl = 'https://lightning.ambientweather.net/devices?public.slug=e63ff0d2119b8c024b5aad24cc59a504';
                this.forecastApiUrl = 'https://api.open-meteo.com/v1/forecast';
                this.spotLocation = [12.346596280786017, 99.99817902532192];
                this.updateInterval = null;
            }

            mphToMs(mph) {
                return mph * 0.44704;
            }

            mphToKnots(mph) {
                return mph * 0.868976;
            }

            async fetchCurrentWindData() {
                try {
                    const response = await fetch(this.apiUrl);
                    const result = await response.json();
                    
                    if (result.data && result.data.length > 0) {
                        const device = result.data[0];
                        const lastData = device.lastData;
                        
                        return {
                            windSpeedKnots: this.mphToKnots(lastData.windspeedmph || 0),
                            windGustKnots: this.mphToKnots(lastData.windgustmph || 0),
                            maxGustKnots: this.mphToKnots(lastData.maxdailygust || 0),
                            windDir: lastData.winddir || 0,
                            windDirAvg: lastData.winddir_avg10m || 0,
                            temperature: lastData.tempf || 0,
                            humidity: lastData.humidity || 0,
                            pressure: lastData.baromrelin || 0,
                            timestamp: new Date(lastData.dateutc)
                        };
                    }
                    throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Ç—Ä–µ:', error);
                    throw error;
                }
            }

            async fetchWindForecast() {
                const lat = this.spotLocation[0];
                const lon = this.spotLocation[1];
                
                try {
                    const url = `${this.forecastApiUrl}?latitude=${lat}&longitude=${lon}&hourly=wind_speed_10m,wind_direction_10m,wind_gusts_10m&timezone=Asia/Bangkok&forecast_days=3`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data && data.hourly) {
                        return this.processForcastData(data);
                    }
                    throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞:', error);
                    throw error;
                }
            }

            processForcastData(data) {
                const hourly = data.hourly;
                const hoursToShow = [];
                const now = new Date();
                const startHour = 6; // –Ω–∞—á–∏–Ω–∞–µ–º —Å 6 —É—Ç—Ä–∞

                for (let day = 0; day < 3; day++) {
                    for (let hour = startHour; hour <= 20; hour += 2) {
                        const hourIndex = day * 24 + hour;
                        if (hourIndex < hourly.time.length) {
                            const datetime = new Date(hourly.time[hourIndex]);
                            const windSpeed = (hourly.wind_speed_10m[hourIndex] * 1.944); // –º/—Å –≤ —É–∑–ª—ã
                            const windDir = hourly.wind_direction_10m[hourIndex];
                            const windGust = (hourly.wind_gusts_10m[hourIndex] * 1.944);

                            hoursToShow.push({
                                date: datetime,
                                time: hour,
                                speed: windSpeed,
                                direction: windDir,
                                gust: windGust
                            });
                        }
                    }
                }

                return hoursToShow;
            }

            getWindSafety(direction, speed) {
                const dir = parseInt(direction);
                const knots = parseFloat(speed) || 0;

                // –û–ü–ê–°–ù–´–ô offshore (–æ—Ç–∂–∏–º): 225¬∞-315¬∞ (–Æ–ó-–°–ó) - –≤–µ—Ç–µ—Ä –¥—É–µ—Ç –° –ë–ï–†–ï–ì–ê –í –ú–û–†–ï
                const isOffshore = (dir >= 225 && dir <= 315);
                // –ë–ï–ó–û–ü–ê–°–ù–´–ô onshore (–ø—Ä–∏–∂–∏–º): 45¬∞-135¬∞ (–°–í-–Æ–í) - –≤–µ—Ç–µ—Ä –¥—É–µ—Ç –° –ú–û–†–Ø –ù–ê –ë–ï–†–ï–ì
                const isOnshore = (dir >= 45 && dir <= 135);

                let safetyLevel = 'medium';
                let safetyText = '–£–º–µ—Ä–µ–Ω–Ω–æ';
                let safetyColor = '#FFA500';

                if (knots < 5) {
                    // –°–ª–∞–±—ã–π –≤–µ—Ç–µ—Ä
                    safetyLevel = 'low';
                    safetyText = '–°–ª–∞–±—ã–π –≤–µ—Ç–µ—Ä';
                    safetyColor = '#87CEEB';
                } else if (isOffshore || knots > 30) {
                    // Offshore (–æ—Ç–∂–∏–º) –∏–ª–∏ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä = –û–ü–ê–°–ù–û (–∫—Ä–∞—Å–Ω—ã–π)
                    safetyLevel = 'danger';
                    safetyText = '–û–ø–∞—Å–Ω–æ!';
                    safetyColor = '#FF4500';
                } else if (isOnshore && knots >= 12 && knots <= 25) {
                    // Onshore (–ø—Ä–∏–∂–∏–º) —Å —Ö–æ—Ä–æ—à–∏–º –≤–µ—Ç—Ä–æ–º = –û–¢–õ–ò–ß–ù–û (–∑–µ–ª–µ–Ω—ã–π)
                    safetyLevel = 'high';
                    safetyText = '–û—Ç–ª–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è!';
                    safetyColor = '#00FF00';
                } else if (isOnshore && knots >= 5 && knots < 12) {
                    // Onshore (–ø—Ä–∏–∂–∏–º) —Å–æ —Å–ª–∞–±—ã–º-—Å—Ä–µ–¥–Ω–∏–º –≤–µ—Ç—Ä–æ–º = –ë–ï–ó–û–ü–ê–°–ù–û (–∂–µ–ª—Ç—ã–π)
                    safetyLevel = 'good';
                    safetyText = '–ë–µ–∑–æ–ø–∞—Å–Ω–æ';
                    safetyColor = '#FFD700';
                } else if (knots >= 8 && knots <= 15) {
                    // Sideshore —Å —É–º–µ—Ä–µ–Ω–Ω—ã–º –≤–µ—Ç—Ä–æ–º = –•–û–†–û–®–û (–∂–µ–ª—Ç—ã–π)
                    safetyLevel = 'good';
                    safetyText = '–•–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è';
                    safetyColor = '#FFD700';
                }

                return {
                    level: safetyLevel,
                    text: safetyText,
                    color: safetyColor,
                    isOffshore,
                    isOnshore,
                    windSpeed: knots,
                    windDirection: dir
                };
            }

            startAutoUpdate(callback, intervalMs = 30000) {
                this.updateInterval = setInterval(async () => {
                    try {
                        const data = await this.fetchCurrentWindData();
                        callback(data);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
                    }
                }, intervalMs);
            }

            stopAutoUpdate() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
            }
        }

        // MapController Class  
        class MapController {
            constructor() {
                this.map = null;
                this.kitesurferMarker = null;
                this.spotMarkers = [];
                
                // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                this.spotLocation = [12.346596280786017, 99.99817902532192]; // JollyKite —Å–ø–æ—Ç
                this.kiterLocation = [12.3468, 100.0125]; // –ö–∞–π—Ç–µ—Ä –≤ –º–æ—Ä–µ
                this.beachNorth = [12.350, 99.996];
                this.beachSouth = [12.343, 100.001];
                this.seaBearing = 90;
                this.landBearing = 270;
            }

            initMap() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
                const mapCenter = [this.spotLocation[0], this.spotLocation[1] - 0.002]; // –°–¥–≤–∏–≥ –≤–ª–µ–≤–æ

                this.map = L.map('windMap', {
                    center: mapCenter,
                    zoom: 14,
                    zoomControl: true,
                    attributionControl: false
                });

                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–ª–æ–≤ –∫–∞—Ä—Ç—ã
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ''
                }).addTo(this.map);

                // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
                this.map.on('zoomstart', (e) => {
                    console.log('üîç ZOOMSTART - –ù–∞—á–∞–ª–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã');
                    console.log('  - –¢–µ–∫—É—â–∏–π zoom:', this.map.getZoom());
                });

                this.map.on('zoom', (e) => {
                    console.log('üîç ZOOM - –ü—Ä–æ—Ü–µ—Å—Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è');
                    console.log('  - –¢–µ–∫—É—â–∏–π zoom:', this.map.getZoom());
                });

                this.map.on('zoomend', (e) => {
                    console.log('üîç ZOOMEND - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è');
                    console.log('  - –§–∏–Ω–∞–ª—å–Ω—ã–π zoom:', this.map.getZoom());
                    console.log('  - –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã:', this.map.getCenter());
                });

                this.addMarkers();
                return this.map;
            }

            addMarkers() {
                // –ò–∫–æ–Ω–∫–∞ –∫–∞–π—Ç—Å–µ—Ä—Ñ–µ—Ä–∞
                const kitesurferIcon = L.icon({
                    iconUrl: 'kiter.png',
                    iconSize: [60, 60],
                    iconAnchor: [30, 30],
                    popupAnchor: [0, -30]
                });

                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –∫–∞–π—Ç—Å–µ—Ä—Ñ–µ—Ä–∞
                this.kitesurferMarker = L.marker(this.kiterLocation, { 
                    icon: kitesurferIcon 
                }).addTo(this.map);

                // –ú–∞—Ä–∫–µ—Ä —Å–ø–æ—Ç–∞ JollyKite
                const spotMarker = L.marker(this.spotLocation, {
                    icon: L.divIcon({
                        html: '<div class="spot-marker">üèñÔ∏è</div>',
                        className: 'spot-icon',
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    })
                }).addTo(this.map);
                spotMarker.bindPopup('<b>JollyKite Spot</b><br>–õ—É—á—à–µ–µ –º–µ—Å—Ç–æ –¥–ª—è –∫–∞–π—Ç—Å–µ—Ä—Ñ–∏–Ω–≥–∞!');

                // –ú–∞—Ä–∫–µ—Ä –ø–ª—è–∂–∞
                const beachMarker = L.marker([12.347, 99.998], {
                    icon: L.divIcon({
                        html: '<div class="beach-marker">üèñÔ∏è</div>',
                        className: 'beach-icon',
                        iconSize: [25, 25],
                        iconAnchor: [12, 12]
                    })
                }).addTo(this.map);
                beachMarker.bindPopup('–ü–ª—è–∂ –ü–∞–∫ –ù–∞–º –ü—Ä–∞–Ω');

                // –ú–∞—Ä–∫–µ—Ä –ø–∞—Ä–∫–æ–≤–∫–∏
                const parkingMarker = L.marker([12.3445, 99.9985], {
                    icon: L.divIcon({
                        html: '<div class="parking-marker">üÖøÔ∏è</div>',
                        className: 'parking-icon',
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                }).addTo(this.map);
                parkingMarker.bindPopup('–ü–∞—Ä–∫–æ–≤–∫–∞');

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                this.spotMarkers = [spotMarker, beachMarker, parkingMarker];
            }

            getKiterLocation() {
                return this.kiterLocation;
            }

            getSpotLocation() {
                return this.spotLocation;
            }

            addWindArrow(windArrowMarker) {
                if (windArrowMarker && this.map) {
                    windArrowMarker.addTo(this.map);
                }
            }

            removeWindArrow(windArrowMarker) {
                if (windArrowMarker && this.map) {
                    this.map.removeLayer(windArrowMarker);
                }
            }

            destroy() {
                if (this.map) {
                    this.map.remove();
                    this.map = null;
                }
            }
        }

        // ForecastManager Class
        class ForecastManager {
            constructor() {
                this.forecastContainer = null;
            }

            init() {
                this.forecastContainer = document.getElementById('windForecast');
                if (!this.forecastContainer) {
                    console.error('Forecast container not found');
                    return false;
                }
                return true;
            }

            showLoading() {
                if (this.forecastContainer) {
                    this.forecastContainer.innerHTML = `
                        <div class="text-center py-8">
                            <div class="inline-block w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin mb-3"></div>
                            <p class="text-white/80">–ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞...</p>
                        </div>
                    `;
                }
            }

            showError(error) {
                if (this.forecastContainer) {
                    this.forecastContainer.innerHTML = `
                        <div class="forecast-loading">
                            <p class="text-red-400">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞: ${error.message}</p>
                        </div>
                    `;
                }
            }

            displayForecast(hoursData) {
                if (!this.forecastContainer) return;

                const getWindSafety = (direction, speed) => {
                    const dir = parseInt(direction);
                    const knots = parseFloat(speed) || 0;

                    // –û–ü–ê–°–ù–´–ô offshore (–æ—Ç–∂–∏–º): 225¬∞-315¬∞ (–Æ–ó-–°–ó) - –≤–µ—Ç–µ—Ä –¥—É–µ—Ç –° –ë–ï–†–ï–ì–ê –í –ú–û–†–ï
                    const isOffshore = (dir >= 225 && dir <= 315);
                    // –ë–ï–ó–û–ü–ê–°–ù–´–ô onshore (–ø—Ä–∏–∂–∏–º): 45¬∞-135¬∞ (–°–í-–Æ–í) - –≤–µ—Ç–µ—Ä –¥—É–µ—Ç –° –ú–û–†–Ø –ù–ê –ë–ï–†–ï–ì
                    const isOnshore = (dir >= 45 && dir <= 135);

                    let safetyLevel = 'medium';
                    let safetyColor = '#FFA500';
                    let isGoodForKiting = false;

                    if (knots < 5) {
                        // –°–ª–∞–±—ã–π –≤–µ—Ç–µ—Ä
                        safetyLevel = 'low';
                        safetyColor = '#87CEEB';
                    } else if (isOffshore || knots > 30) {
                        // Offshore (–æ—Ç–∂–∏–º) –∏–ª–∏ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä = –û–ü–ê–°–ù–û (–∫—Ä–∞—Å–Ω—ã–π)
                        safetyLevel = 'danger';
                        safetyColor = '#FF4500';
                    } else if (isOnshore && knots >= 12 && knots <= 25) {
                        // Onshore (–ø—Ä–∏–∂–∏–º) —Å —Ö–æ—Ä–æ—à–∏–º –≤–µ—Ç—Ä–æ–º = –û–¢–õ–ò–ß–ù–û (–∑–µ–ª–µ–Ω—ã–π)
                        safetyLevel = 'high';
                        safetyColor = '#00FF00';
                        isGoodForKiting = true;
                    } else if (isOnshore && knots >= 5 && knots < 12) {
                        // Onshore (–ø—Ä–∏–∂–∏–º) —Å–æ —Å–ª–∞–±—ã–º-—Å—Ä–µ–¥–Ω–∏–º –≤–µ—Ç—Ä–æ–º = –ë–ï–ó–û–ü–ê–°–ù–û (–∂–µ–ª—Ç—ã–π)
                        safetyLevel = 'good';
                        safetyColor = '#FFD700';
                    } else if (knots >= 8 && knots <= 15) {
                        // Sideshore —Å —É–º–µ—Ä–µ–Ω–Ω—ã–º –≤–µ—Ç—Ä–æ–º = –•–û–†–û–®–û (–∂–µ–ª—Ç—ã–π)
                        safetyLevel = 'good';
                        safetyColor = '#FFD700';
                    }

                    return {
                        level: safetyLevel,
                        color: safetyColor,
                        isOffshore,
                        isOnshore,
                        isGoodForKiting
                    };
                };

                const getWindIcon = (speed) => {
                    if (speed < 5) return 'üí®';
                    if (speed < 12) return 'üå¨Ô∏è';
                    if (speed < 20) return 'üí®';
                    if (speed < 30) return 'üå™Ô∏è';
                    return '‚ö°';
                };

                const getCardinalDirection = (degrees) => {
                    const directions = ['–°', '–°–í', '–í', '–Æ–í', '–Æ', '–Æ–ó', '–ó', '–°–ó'];
                    const index = Math.round(degrees / 45) % 8;
                    return directions[index];
                };

                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–Ω—è–º
                const dayGroups = {};
                hoursData.forEach(hour => {
                    const dayKey = hour.date.toDateString();
                    if (!dayGroups[dayKey]) {
                        dayGroups[dayKey] = [];
                    }
                    dayGroups[dayKey].push(hour);
                });

                let forecastHTML = '';
                Object.entries(dayGroups).forEach(([dayKey, group]) => {
                    const dayName = this.getDayName(new Date(dayKey));
                    
                    forecastHTML += `
                        <div class="mb-6">
                            <div class="text-sm font-semibold text-white mb-3 text-center bg-white/10 rounded-lg py-2">
                                ${dayName}
                            </div>
                            <div class="flex gap-1 min-w-full">
                    `;

                    group.forEach(hour => {
                        const safety = getWindSafety(hour.direction, hour.speed);
                        const windIcon = getWindIcon(hour.speed);
                        const cardinalDir = getCardinalDirection(hour.direction);
                        const kiteIcon = safety.isGoodForKiting ? 'ü™Å' : '';

                        forecastHTML += `
                            <div class="flex-1 min-w-[60px] rounded-lg p-2 flex flex-col justify-between items-center text-center cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
                                 style="background: ${safety.color}; border: 2px solid ${safety.color}; box-shadow: 0 0 15px ${safety.color}40;"
                                 onclick="simulateWind(${hour.direction}, ${hour.speed})" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏">
                                <div class="text-xs font-semibold text-white drop-shadow-md">${hour.time}:00 ${kiteIcon}</div>
                                <div class="text-lg my-1 drop-shadow-md">${windIcon}</div>
                                <div class="text-sm font-bold text-white drop-shadow-md">${hour.speed.toFixed(1)}</div>
                                <div class="text-xs text-white/90 drop-shadow-sm">${cardinalDir}</div>
                            </div>
                        `;
                    });

                    forecastHTML += `
                            </div>
                        </div>
                    `;
                });

                this.forecastContainer.innerHTML = forecastHTML;
            }

            getDayName(date) {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dayAfterTomorrow = new Date(today);
                dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);

                const targetDate = new Date(date);
                
                if (targetDate.toDateString() === today.toDateString()) {
                    return '–°–µ–≥–æ–¥–Ω—è';
                } else if (targetDate.toDateString() === tomorrow.toDateString()) {
                    return '–ó–∞–≤—Ç—Ä–∞';
                } else if (targetDate.toDateString() === dayAfterTomorrow.toDateString()) {
                    return '–ü–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞';
                } else {
                    const options = { 
                        weekday: 'long', 
                        day: 'numeric', 
                        month: 'short' 
                    };
                    return targetDate.toLocaleDateString('ru-RU', options);
                }
            }

            setupSimulation(simulateCallback) {
                window.simulateWind = simulateCallback;
            }

            clear() {
                if (this.forecastContainer) {
                    this.forecastContainer.innerHTML = '';
                }
            }
        }

        // WindArrowController Class
        class WindArrowController {
            constructor(mapController, windDataManager) {
                this.mapController = mapController;
                this.windDataManager = windDataManager;
                this.windArrowMarker = null;
                this.windDirection = 0;
                this.windSpeed = 0;
                this.isInitialized = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            }

            createArrowSVG(safety) {
                const color = safety.color;
                const darkerColor = this.getDarkerColor(color);

                return `
                    <svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="arrowGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                                <stop offset="100%" style="stop-color:${darkerColor};stop-opacity:1" />
                            </linearGradient>
                            <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                                <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="black" flood-opacity="0.3"/>
                            </filter>
                        </defs>
                        <path d="M 30 5 L 40 25 L 35 25 L 35 50 L 25 50 L 25 25 L 20 25 Z"
                              fill="url(#arrowGrad)"
                              stroke="${darkerColor}"
                              stroke-width="2"
                              filter="url(#shadow)"
                              style="animation: windPulse 2s ease-in-out infinite;">
                            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
                        </path>
                    </svg>
                `;
            }

            getDarkerColor(color) {
                const colors = {
                    '#00FF00': '#00CC00',
                    '#FFD700': '#DAA520',
                    '#FFA500': '#FF8C00',
                    '#FF4500': '#DC143C',
                    '#87CEEB': '#4682B4',
                    '#4169E1': '#0000CD'
                };
                return colors[color] || color;
            }

            updateArrow() {
                console.log('üéØ updateArrow() –≤—ã–∑–≤–∞–Ω');

                if (!this.mapController.map) {
                    console.log('‚ùå –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                    return;
                }

                // –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –¥–æ –ø–µ—Ä–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
                if (!this.isInitialized) {
                    console.log('‚è≥ –°—Ç—Ä–µ–ª–∫–∞ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–∂–¥–µ–º –¥–∞–Ω–Ω—ã—Ö –∏–∑ API)');
                    return;
                }

                const safety = this.windDataManager.getWindSafety(this.windDirection, this.windSpeed);
                const kiterLocation = this.mapController.getKiterLocation();

                console.log('üìç –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç—Ä–µ–ª–∫–∏:');
                console.log('  - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞:', this.windDirection + '¬∞');
                console.log('  - –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞:', this.windSpeed.toFixed(1), '—É–∑–ª–æ–≤');
                console.log('  - –ü–æ–∑–∏—Ü–∏—è –∫–∞–π—Ç–µ—Ä–∞:', kiterLocation);
                console.log('  - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:', safety.text, '(' + safety.color + ')');

                // –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü–æ–∑–∏—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∏ —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π –º–µ–∂–¥—É 8 –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
                const dir = this.windDirection;
                let arrowPosition = [...kiterLocation]; // –ö–æ–ø–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

                // –ü–æ–ª—É—á–∞–µ–º —Å–º–µ—â–µ–Ω–∏—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
                const config = window.arrowOffsets || {
                    globalAngle: 0,
                    directions: {
                        0: { x: -0.0043, y: 0.0006 },
                        45: { x: -0.0004, y: 0.0041 },
                        90: { x: -0.0004, y: 0.0041 },
                        135: { x: 0.003, y: 0.0011 },
                        180: { x: 0.003, y: 0.0011 },
                        225: { x: -0.0005, y: 0.0036 },
                        270: { x: -0.0005, y: 0.0036 },
                        315: { x: -0.0005, y: 0.0036 }
                    }
                };

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ñ—Å–µ—Ç–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π
                const getOffsetForDirection = (angle) => {
                    const directions = [0, 45, 90, 135, 180, 225, 270, 315];

                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —É–≥–æ–ª (0-360)
                    let normalizedAngle = angle % 360;
                    if (normalizedAngle < 0) normalizedAngle += 360;

                    // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    let lowerDir = 0;
                    let upperDir = 0;

                    for (let i = 0; i < directions.length; i++) {
                        if (normalizedAngle >= directions[i]) {
                            lowerDir = directions[i];
                            upperDir = directions[(i + 1) % directions.length];
                        }
                    }

                    // –ï—Å–ª–∏ —É–≥–æ–ª –º–µ–∂–¥—É 315 –∏ 360, –≤–µ—Ä—Ö–Ω–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - 0
                    if (normalizedAngle > 315) {
                        lowerDir = 315;
                        upperDir = 0;
                    }

                    // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–¥–Ω–∏–º –∏–∑ 8 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
                    if (directions.includes(normalizedAngle)) {
                        return config.directions[normalizedAngle];
                    }

                    // –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –±–ª–∏–∂–∞–π—à–∏–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
                    const lowerOffset = config.directions[lowerDir];
                    const upperOffset = config.directions[upperDir];

                    let angleDiff = upperDir - lowerDir;
                    if (angleDiff < 0) angleDiff += 360; // –ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 0

                    let currentDiff = normalizedAngle - lowerDir;
                    if (currentDiff < 0) currentDiff += 360;

                    const ratio = currentDiff / angleDiff;

                    return {
                        x: lowerOffset.x + (upperOffset.x - lowerOffset.x) * ratio,
                        y: lowerOffset.y + (upperOffset.y - lowerOffset.y) * ratio
                    };
                };

                const offset = getOffsetForDirection(dir);
                arrowPosition = [
                    kiterLocation[0] + offset.x,
                    kiterLocation[1] + offset.y
                ];

                console.log('  üìê –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞: ' + dir + '¬∞');
                console.log('  üìç –°–º–µ—â–µ–Ω–∏–µ:', offset);

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤–µ—Ç—Ä–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                if (dir >= 45 && dir <= 135) {
                    console.log('  ‚úÖ ONSHORE (–ë–ï–ó–û–ü–ê–°–ù–û): –í–µ—Ç–µ—Ä —Å –º–æ—Ä—è –Ω–∞ –±–µ—Ä–µ–≥');
                } else if (dir >= 225 && dir <= 315) {
                    console.log('  ‚ö†Ô∏è OFFSHORE (–û–ü–ê–°–ù–û): –í–µ—Ç–µ—Ä —Å –±–µ—Ä–µ–≥–∞ –≤ –º–æ—Ä–µ');
                } else {
                    console.log('  üîÑ SIDESHORE: –ë–æ–∫–æ–≤–æ–π –≤–µ—Ç–µ—Ä');
                }

                console.log('  - –ü–æ–∑–∏—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∏:', arrowPosition);

                // –ï—Å–ª–∏ –º–∞—Ä–∫–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∏–∫–æ–Ω–∫—É –∏ –ø–æ–≤–æ—Ä–æ—Ç
                if (this.windArrowMarker) {
                    console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–∞—Ä–∫–µ—Ä–∞');
                    const currentPos = this.windArrowMarker.getLatLng();
                    console.log('  - –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –º–∞—Ä–∫–µ—Ä–∞:', [currentPos.lat, currentPos.lng]);

                    // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏–∫–æ–Ω–∫–∏
                    this.windArrowMarker.setLatLng(arrowPosition);
                    console.log('  üîß –ü–æ–∑–∏—Ü–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', arrowPosition);

                    // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—Ä–∫–µ—Ä–∞
                    if (this.windArrowMarker.update) {
                        this.windArrowMarker.update();
                        console.log('  üîß –í—ã–∑–≤–∞–Ω marker.update()');
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É (—Ü–≤–µ—Ç –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
                    const windArrowIcon = L.divIcon({
                        html: this.createArrowSVG(safety),
                        className: 'wind-arrow-container',
                        iconSize: [60, 60],
                        iconAnchor: [30, 30]
                    });

                    this.windArrowMarker.setIcon(windArrowIcon);
                    console.log('  ‚úÖ –ò–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');

                    // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã –∏–∫–æ–Ω–∫–∏ —Å–Ω–æ–≤–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                    if (this.windArrowMarker.update) {
                        this.windArrowMarker.update();
                        console.log('  üîß –í—ã–∑–≤–∞–Ω marker.update() –ø–æ—Å–ª–µ setIcon()');
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç (—Å —É—á–µ—Ç–æ–º –æ–±—â–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —É–≥–ª–∞)
                    const element = this.windArrowMarker.getElement();
                    if (element) {
                        // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º transform, –∞ –¥–æ–±–∞–≤–ª—è–µ–º rotate –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É translate3d
                        const currentTransform = element.style.transform;
                        const translateMatch = currentTransform.match(/translate3d\([^)]+\)/);

                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—â—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É —É–≥–ª–∞
                        const globalAngleOffset = config.globalAngle || 0;
                        const finalRotation = this.windDirection + 180 + globalAngleOffset;

                        if (translateMatch) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º translate3d –∏ –¥–æ–±–∞–≤–ª—è–µ–º rotate
                            element.style.transform = `${translateMatch[0]} rotate(${finalRotation}deg)`;
                            console.log('  üîß Transform —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', element.style.transform);
                        } else {
                            // –ï—Å–ª–∏ –Ω–µ—Ç translate3d, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º rotate
                            element.style.transform = `rotate(${finalRotation}deg)`;
                        }

                        element.style.transformOrigin = 'center';
                        element.title = `–í–µ—Ç–µ—Ä: ${this.windSpeed.toFixed(1)} —É–∑–ª–æ–≤, ${this.windDirection}¬∞\n${safety.text}`;
                        console.log('  ‚úÖ –ü–æ–≤–æ—Ä–æ—Ç: ' + this.windDirection + '¬∞ + –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ ' + globalAngleOffset + '¬∞ = ' + finalRotation + '¬∞');
                    }

                    const finalPos = this.windArrowMarker.getLatLng();
                    console.log('  - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –º–∞—Ä–∫–µ—Ä–∞:', [finalPos.lat, finalPos.lng]);
                } else {
                    console.log('üÜï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞');
                    console.log('  - –ü–æ–∑–∏—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:', arrowPosition);

                    // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑
                    const windArrowIcon = L.divIcon({
                        html: this.createArrowSVG(safety),
                        className: 'wind-arrow-container',
                        iconSize: [60, 60],
                        iconAnchor: [30, 30]
                    });

                    this.windArrowMarker = L.marker(arrowPosition, {
                        icon: windArrowIcon
                    });
                    console.log('  ‚úÖ –ú–∞—Ä–∫–µ—Ä —Å–æ–∑–¥–∞–Ω');

                    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç—É
                    this.mapController.addWindArrow(this.windArrowMarker);
                    console.log('  ‚úÖ –ú–∞—Ä–∫–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É');

                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –ø–æ–≤–æ—Ä–æ—Ç –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                    setTimeout(() => {
                        if (this.windArrowMarker && this.mapController.map) {
                            console.log('  üîß setTimeout: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏');

                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞
                            this.windArrowMarker.setLatLng(arrowPosition);

                            // –ö–õ–Æ–ß–ï–í–û–ô –§–ò–ö–°: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ Leaflet
                            if (this.windArrowMarker.update) {
                                this.windArrowMarker.update();
                                console.log('  üîß –í—ã–∑–≤–∞–Ω marker.update()');
                            }

                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–∞—Ä—Ç—ã
                            this.mapController.map.invalidateSize(false);
                            console.log('  üîß –í—ã–∑–≤–∞–Ω map.invalidateSize()');

                            const pos = this.windArrowMarker.getLatLng();
                            console.log('  - –ü–æ–∑–∏—Ü–∏—è –ø–æ—Å–ª–µ setLatLng:', [pos.lat, pos.lng]);

                            const element = this.windArrowMarker.getElement();
                            if (element) {
                                // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–ö–°: –ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º transform, –∞ –¥–æ–±–∞–≤–ª—è–µ–º rotate –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É translate3d
                                const currentTransform = element.style.transform;
                                const translateMatch = currentTransform.match(/translate3d\([^)]+\)/);

                                // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—â—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É —É–≥–ª–∞
                                const globalAngleOffset = config.globalAngle || 0;
                                const finalRotation = this.windDirection + 180 + globalAngleOffset;

                                if (translateMatch) {
                                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º translate3d –∏ –¥–æ–±–∞–≤–ª—è–µ–º rotate
                                    element.style.transform = `${translateMatch[0]} rotate(${finalRotation}deg)`;
                                    console.log('  üîß Transform —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', element.style.transform);
                                } else {
                                    // –ï—Å–ª–∏ –Ω–µ—Ç translate3d, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º rotate
                                    element.style.transform = `rotate(${finalRotation}deg)`;
                                }

                                element.style.transformOrigin = 'center';
                                element.title = `–í–µ—Ç–µ—Ä: ${this.windSpeed.toFixed(1)} —É–∑–ª–æ–≤, ${this.windDirection}¬∞\n${safety.text}`;
                                console.log('  ‚úÖ –ü–æ–≤–æ—Ä–æ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞', this.windDirection + '¬∞');
                            }
                        }
                    }, 100);
                }
            }

            updateWind(direction, speed) {
                console.log('üå¨Ô∏è updateWind() –≤—ã–∑–≤–∞–Ω —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:', {direction: direction + '¬∞', speed: speed.toFixed(1) + ' —É–∑–ª–æ–≤'});
                this.windDirection = direction;
                this.windSpeed = speed;
                this.isInitialized = true; // –ü–æ–º–µ—á–∞–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã
                this.updateArrow();
            }

            getWindArrowMarker() {
                return this.windArrowMarker;
            }

            clear() {
                if (this.windArrowMarker) {
                    this.mapController.removeWindArrow(this.windArrowMarker);
                    this.windArrowMarker = null;
                }
            }
        }

        // WindStatistics Class
        class WindStatistics {
            constructor() {
                this.windHistory = [];
                this.maxHistoryMinutes = 60; // –•—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
                this.analysisIntervalMinutes = 5; // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞ 5 –º–∏–Ω—É—Ç (–≤–º–µ—Å—Ç–æ 15)
                this.storageKey = 'jolly-kite-wind-statistics';

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                this.loadFromStorage();
            }

            loadFromStorage() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    if (stored) {
                        const data = JSON.parse(stored);
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º timestamp –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã Date
                        this.windHistory = data.map(m => ({
                            ...m,
                            timestamp: new Date(m.timestamp)
                        }));

                        // –û—á–∏—â–∞–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
                        this.cleanOldData();

                        console.log(`‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.windHistory.length} –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏–∑ –∫–µ—à–∞`);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –∫–µ—à–∞:', error);
                    this.windHistory = [];
                }
            }

            saveToStorage() {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.windHistory));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∫–µ—à:', error);
                }
            }

            addMeasurement(windData) {
                const measurement = {
                    speed: windData.windSpeedKnots,
                    direction: windData.windDir,
                    gust: windData.windGustKnots,
                    timestamp: windData.timestamp || new Date()
                };

                this.windHistory.push(measurement);
                this.cleanOldData();
                this.saveToStorage();
            }

            cleanOldData() {
                const now = new Date();
                const cutoffTime = new Date(now.getTime() - this.maxHistoryMinutes * 60 * 1000);
                const beforeCount = this.windHistory.length;
                this.windHistory = this.windHistory.filter(m => m.timestamp >= cutoffTime);

                // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –∑–∞–ø–∏—Å–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                if (beforeCount !== this.windHistory.length) {
                    this.saveToStorage();
                }
            }

            getAverageSpeed(minutes) {
                const now = new Date();
                const cutoffTime = new Date(now.getTime() - minutes * 60 * 1000);
                const recentMeasurements = this.windHistory.filter(m => m.timestamp >= cutoffTime);

                if (recentMeasurements.length === 0) {
                    return null;
                }

                const sum = recentMeasurements.reduce((acc, m) => acc + m.speed, 0);
                return sum / recentMeasurements.length;
            }

            analyzeTrend() {
                if (this.windHistory.length < 2) {
                    return {
                        trend: 'insufficient_data',
                        text: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö',
                        icon: '‚è≥',
                        color: '#808080'
                    };
                }

                const currentAverage = this.getAverageSpeed(this.analysisIntervalMinutes);
                const previousAverage = this.getAverageInTimeRange(
                    this.analysisIntervalMinutes,
                    this.analysisIntervalMinutes * 2
                );

                if (currentAverage === null || previousAverage === null) {
                    return {
                        trend: 'insufficient_data',
                        text: '–ù–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ...',
                        icon: '‚è≥',
                        color: '#808080',
                        currentSpeed: currentAverage,
                        previousSpeed: previousAverage
                    };
                }

                const speedChange = currentAverage - previousAverage;
                const percentChange = (speedChange / previousAverage) * 100;

                if (Math.abs(percentChange) < 5) {
                    return {
                        trend: 'stable',
                        text: '–°—Ç–∞–±–∏–ª—å–Ω—ã–π',
                        icon: '‚û°Ô∏è',
                        color: '#4169E1',
                        currentSpeed: currentAverage,
                        previousSpeed: previousAverage,
                        change: speedChange,
                        percentChange: percentChange
                    };
                } else if (speedChange > 0) {
                    return {
                        trend: 'strengthening',
                        text: '–†–∞–∑–¥—É–≤–∞–µ—Ç',
                        icon: '‚ÜóÔ∏è',
                        color: '#FF8C00',
                        currentSpeed: currentAverage,
                        previousSpeed: previousAverage,
                        change: speedChange,
                        percentChange: percentChange
                    };
                } else {
                    return {
                        trend: 'weakening',
                        text: '–ó–∞—Ç–∏—Ö–∞–µ—Ç',
                        icon: '‚ÜòÔ∏è',
                        color: '#87CEEB',
                        currentSpeed: currentAverage,
                        previousSpeed: previousAverage,
                        change: speedChange,
                        percentChange: percentChange
                    };
                }
            }

            getAverageInTimeRange(startMinutes, endMinutes) {
                const now = new Date();
                const startTime = new Date(now.getTime() - endMinutes * 60 * 1000);
                const endTime = new Date(now.getTime() - startMinutes * 60 * 1000);

                const measurements = this.windHistory.filter(
                    m => m.timestamp >= startTime && m.timestamp < endTime
                );

                if (measurements.length === 0) {
                    return null;
                }

                const sum = measurements.reduce((acc, m) => acc + m.speed, 0);
                return sum / measurements.length;
            }

            getMeasurementCount() {
                return this.windHistory.length;
            }

            clearHistory() {
                this.windHistory = [];
                this.saveToStorage();
                console.log('‚úì –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—á–∏—â–µ–Ω–∞');
            }

            getCacheInfo() {
                const oldest = this.windHistory.length > 0
                    ? this.windHistory[0].timestamp
                    : null;
                const newest = this.windHistory.length > 0
                    ? this.windHistory[this.windHistory.length - 1].timestamp
                    : null;

                const sizeInBytes = new Blob([JSON.stringify(this.windHistory)]).size;
                const sizeInKB = (sizeInBytes / 1024).toFixed(2);

                return {
                    entries: this.windHistory.length,
                    sizeKB: sizeInKB,
                    sizeBytes: sizeInBytes,
                    oldestEntry: oldest,
                    newestEntry: newest,
                    storageKey: this.storageKey,
                    maxHistoryMinutes: this.maxHistoryMinutes
                };
            }
        }

        // App Class
        class App {
            constructor() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                this.windDataManager = new WindDataManager();
                this.mapController = new MapController();
                this.forecastManager = new ForecastManager();
                this.windStatistics = new WindStatistics();

                this.windArrowController = null; // –ë—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –∫–∞—Ä—Ç—ã
                this.updateInterval = null;
                this.isInitialized = false;
            }

            async init() {
                try {
                    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JollyKite App...');
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
                    this.mapController.initMap();
                    console.log('‚úì –ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Å—Ç—Ä–µ–ª–∫–∏ –≤–µ—Ç—Ä–∞
                    this.windArrowController = new WindArrowController(
                        this.mapController, 
                        this.windDataManager
                    );
                    console.log('‚úì –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å—Ç—Ä–µ–ª–∫–∏ –≤–µ—Ç—Ä–∞ —Å–æ–∑–¥–∞–Ω');

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
                    if (!this.forecastManager.init()) {
                        console.warn('‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≥–Ω–æ–∑–æ–≤');
                    } else {
                        console.log('‚úì –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    }

                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –≤–µ—Ç—Ä–∞ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
                    this.forecastManager.setupSimulation((direction, speed) => {
                        this.simulateWind(direction, speed);
                    });

                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç—Ä–µ–ª–∫–∏ –ø—Ä–∏ –∑—É–º–µ –∫–∞—Ä—Ç—ã
                    this.mapController.map.on('zoomend', () => {
                        if (this.windArrowController && this.windArrowController.windArrowMarker) {
                            const arrowPos = this.windArrowController.windArrowMarker.getLatLng();
                            const kiterPos = this.mapController.getKiterLocation();
                            console.log('üîç –ü–æ—Å–ª–µ –∑—É–º–∞ - –ø–æ–∑–∏—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∏:', [arrowPos.lat, arrowPos.lng]);
                            console.log('üîç –ü–æ—Å–ª–µ –∑—É–º–∞ - –ø–æ–∑–∏—Ü–∏—è –∫–∞–π—Ç–µ—Ä–∞:', kiterPos);
                        }
                    });

                    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    await this.loadInitialData();
                    
                    // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    this.startAutoUpdate();
                    
                    this.isInitialized = true;
                    console.log('‚úÖ JollyKite App —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
                    return false;
                }
            }

            async loadInitialData() {
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Ç—Ä–µ
                try {
                    await this.updateWindData();
                    console.log('‚úì –î–∞–Ω–Ω—ã–µ –æ –≤–µ—Ç—Ä–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                } catch (error) {
                    console.error('‚ö† –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Ç—Ä–µ:', error);
                    this.showWindError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Ç—Ä–µ');
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞
                try {
                    await this.updateForecast();
                    console.log('‚úì –ü—Ä–æ–≥–Ω–æ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω');
                } catch (error) {
                    console.error('‚ö† –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞:', error);
                    this.forecastManager.showError(error);
                }
            }

            async updateWindData() {
                console.log('');
                console.log('üì° ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                console.log('üì° –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –û –í–ï–¢–†–ï –ò–ó API');
                console.log('üì° ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                try {
                    const windData = await this.windDataManager.fetchCurrentWindData();
                    console.log('üì° –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ API:', {
                        windDir: windData.windDir + '¬∞',
                        windSpeed: windData.windSpeedKnots.toFixed(1) + ' —É–∑–ª–æ–≤'
                    });
                    
                    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    const safety = this.windDataManager.getWindSafety(
                        windData.windDir, 
                        windData.windSpeedKnots
                    );
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    windData.safety = safety;
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                    this.updateWindDisplay(windData);

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∏ –≤–µ—Ç—Ä–∞
                    if (this.windArrowController) {
                        this.windArrowController.updateWind(windData.windDir, windData.windSpeedKnots);
                    }

                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    this.windStatistics.addMeasurement(windData);

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
                    this.updateWindTrend();

                    return windData;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Ç—Ä–µ:', error);
                    throw error;
                }
            }

            updateWindTrend() {
                const trend = this.windStatistics.analyzeTrend();
                const trendElement = document.getElementById('windTrend');

                if (trendElement) {
                    trendElement.innerHTML = `
                        <span style="font-size: 1.5em;">${trend.icon}</span>
                        <span style="margin-left: 5px; font-weight: bold;">${trend.text}</span>
                    `;
                    trendElement.style.color = trend.color;

                    // –î–æ–±–∞–≤–ª—è–µ–º tooltip —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
                    if (trend.currentSpeed && trend.previousSpeed) {
                        const changeText = trend.change > 0 ? `+${trend.change.toFixed(1)}` : trend.change.toFixed(1);
                        trendElement.title = `–°–µ–π—á–∞—Å: ${trend.currentSpeed.toFixed(1)} —É–∑–ª–æ–≤\n–ë—ã–ª–æ: ${trend.previousSpeed.toFixed(1)} —É–∑–ª–æ–≤\n–ò–∑–º–µ–Ω–µ–Ω–∏–µ: ${changeText} —É–∑–ª–æ–≤ (${trend.percentChange.toFixed(1)}%)`;
                    } else {
                        trendElement.title = '–ù–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è 10 –º–∏–Ω—É—Ç)';
                    }

                    console.log('üìä –¢—Ä–µ–Ω–¥ –æ–±–Ω–æ–≤–ª–µ–Ω:', {
                        trend: trend.text,
                        icon: trend.icon,
                        measurements: this.windStatistics.getMeasurementCount()
                    });
                }
            }

            updateWindDisplay(windData) {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–µ—Ç—Ä–∞
                const windSpeedElement = document.getElementById('windSpeed');
                if (windSpeedElement) {
                    windSpeedElement.textContent = windData.windSpeedKnots.toFixed(1);
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—ã–≤–æ–≤
                const windGustElement = document.getElementById('windGust');
                if (windGustElement) {
                    windGustElement.textContent = windData.windGustKnots ? windData.windGustKnots.toFixed(1) : '--';
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º–∞ –∑–∞ –¥–µ–Ω—å
                const maxGustElement = document.getElementById('maxGust');
                if (maxGustElement) {
                    maxGustElement.textContent = windData.maxGustKnots ? windData.maxGustKnots.toFixed(1) : '--';
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏—è –≤–µ—Ç—Ä–∞
                this.updateWindDescription(windData);
            }

            updateWindDescription(windData) {
                const windDesc = this.getWindDescription(windData.windSpeedKnots, windData.windDir);

                const windIcon = document.getElementById('windIcon');
                const windTitle = document.getElementById('windTitle');
                const windSubtitle = document.getElementById('windSubtitle');
                const windCardinal = document.getElementById('windCardinal');
                const windSafetyDesc = document.getElementById('windSafetyDesc');

                if (windIcon) windIcon.textContent = windDesc.icon;
                if (windTitle) windTitle.textContent = windDesc.title;
                if (windSubtitle) windSubtitle.textContent = windDesc.subtitle;

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ç—Ä–∞ (—Ä—É–º–±)
                if (windCardinal) {
                    windCardinal.textContent = this.degreesToCardinal(windData.windDir);
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                if (windSafetyDesc && windData.safety) {
                    let safetyText = windData.safety.text;

                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –≤–µ—Ç—Ä–∞ (offshore/onshore)
                    if (windData.safety.isOffshore) {
                        safetyText += ' ‚Ä¢ –û—Ç–∂–∏–º (offshore)';
                    } else if (windData.safety.isOnshore) {
                        safetyText += ' ‚Ä¢ –ü—Ä–∏–∂–∏–º (onshore)';
                    } else {
                        safetyText += ' ‚Ä¢ –ë–æ–∫–æ–≤–æ–π (sideshore)';
                    }

                    windSafetyDesc.textContent = safetyText;
                    windSafetyDesc.style.color = windData.safety.color;
                    windSafetyDesc.style.fontWeight = '600';
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                const windButton = document.getElementById('windDescriptionButton');
                if (windButton && windData.safety) {
                    windButton.style.borderColor = windData.safety.color;
                    windButton.style.boxShadow = `0 0 20px ${windData.safety.color}40`;
                }
            }

            degreesToCardinal(degrees) {
                const deg = parseFloat(degrees) || 0;
                const normalized = ((deg % 360) + 360) % 360; // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ 0-360

                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å 8 —Ä—É–º–±–∞–º–∏
                if (normalized >= 337.5 || normalized < 22.5) return '–°';      // North
                if (normalized >= 22.5 && normalized < 67.5) return '–°–í';      // Northeast
                if (normalized >= 67.5 && normalized < 112.5) return '–í';      // East
                if (normalized >= 112.5 && normalized < 157.5) return '–Æ–í';    // Southeast
                if (normalized >= 157.5 && normalized < 202.5) return '–Æ';     // South
                if (normalized >= 202.5 && normalized < 247.5) return '–Æ–ó';    // Southwest
                if (normalized >= 247.5 && normalized < 292.5) return '–ó';     // West
                if (normalized >= 292.5 && normalized < 337.5) return '–°–ó';    // Northwest
                return '–°'; // Fallback
            }

            getWindDescription(speedKnots, degrees) {
                // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –≤–µ—Ç—Ä–∞
                const speed = parseFloat(speedKnots) || 0;
                
                if (speed < 5) {
                    return {
                        icon: 'üçÉ',
                        title: '–®—Ç–∏–ª—å',
                        subtitle: '–í–µ—Ç—Ä–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Ç'
                    };
                } else if (speed < 12) {
                    return {
                        icon: 'üí®',
                        title: '–õ–µ–≥–∫–∏–π –≤–µ—Ç–µ—Ä',
                        subtitle: `${speed.toFixed(1)} —É–∑–ª–æ–≤`
                    };
                } else if (speed < 20) {
                    return {
                        icon: 'üå¨Ô∏è',
                        title: '–£–º–µ—Ä–µ–Ω–Ω—ã–π –≤–µ—Ç–µ—Ä',
                        subtitle: `${speed.toFixed(1)} —É–∑–ª–æ–≤ - –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è –∫–∞–π—Ç–∞!`
                    };
                } else if (speed < 30) {
                    return {
                        icon: 'üí®',
                        title: '–°–∏–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä',
                        subtitle: `${speed.toFixed(1)} —É–∑–ª–æ–≤ - –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö`
                    };
                } else {
                    return {
                        icon: '‚ö°',
                        title: '–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä',
                        subtitle: `${speed.toFixed(1)} —É–∑–ª–æ–≤ - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!`
                    };
                }
            }

            async updateForecast() {
                try {
                    this.forecastManager.showLoading();
                    const forecastData = await this.windDataManager.fetchWindForecast();
                    this.forecastManager.displayForecast(forecastData);
                } catch (error) {
                    this.forecastManager.showError(error);
                    throw error;
                }
            }

            simulateWind(direction, speed) {
                console.log('');
                console.log('üîò ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                console.log('üîò –ö–ù–û–ü–ö–ê –°–ò–ú–£–õ–Ø–¶–ò–ò –ù–ê–ñ–ê–¢–ê');
                console.log('üîò –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:', direction + '¬∞', '| –°–∫–æ—Ä–æ—Å—Ç—å:', speed, '—É–∑–ª–æ–≤');
                console.log('üîò ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');

                // –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
                const simulatedData = {
                    windSpeedKnots: speed,
                    windDir: direction,
                    windGustKnots: speed * 1.2,
                    windDirAvg: direction,
                    temperature: 85, // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
                    humidity: 65,
                    pressure: 30.1,
                    timestamp: new Date()
                };

                // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                const safety = this.windDataManager.getWindSafety(direction, speed);
                simulatedData.safety = safety;

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                this.updateWindDisplay(simulatedData);

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∏
                if (this.windArrowController) {
                    this.windArrowController.updateWind(direction, speed);
                }

                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                this.windStatistics.addMeasurement(simulatedData);

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
                this.updateWindTrend();
            }

            showWindError(message) {
                const windTitle = document.getElementById('windTitle');
                const windSubtitle = document.getElementById('windSubtitle');
                const windIcon = document.getElementById('windIcon');
                
                if (windTitle) windTitle.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                if (windSubtitle) windSubtitle.textContent = message;
                if (windIcon) windIcon.textContent = '‚ö†Ô∏è';
            }

            startAutoUpdate(intervalMs = 30000) {
                if (this.updateInterval) {
                    this.stopAutoUpdate();
                }
                
                console.log(`–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ ${intervalMs/1000} —Å–µ–∫`);
                this.updateInterval = setInterval(async () => {
                    try {
                        await this.updateWindData();
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
                    }
                }, intervalMs);
            }

            stopAutoUpdate() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                    console.log('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                }
            }

            // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
            getStatisticsCacheInfo() {
                return this.windStatistics.getCacheInfo();
            }

            clearStatisticsCache() {
                this.windStatistics.clearHistory();
                console.log('‚úì –ö–µ—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—á–∏—â–µ–Ω');
            }

            // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å historyManager)
            exportHistoryJSON(hours = null) {
                return this.historyManager ? this.historyManager.exportHistoryJSON(hours) : '{}';
            }

            clearHistory() {
                if (this.historyManager) {
                    return this.historyManager.clearHistory();
                }
            }

            destroy() {
                console.log('–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã JollyKite App...');

                // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                this.stopAutoUpdate();

                // –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ä—Ç—ã
                this.mapController.destroy();

                // –û—á–∏—Å—Ç–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                if (this.windArrowController) {
                    this.windArrowController.clear();
                }

                this.forecastManager.clear();

                this.isInitialized = false;
                console.log('‚úÖ JollyKite App –∑–∞–≤–µ—Ä—à–µ–Ω');
            }
        }
        
        // Global app instance
        let jollyKiteApp;
        
        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Initializing JollyKite App...');
            
            try {
                jollyKiteApp = new App();
                const success = await jollyKiteApp.init();
                
                if (success) {
                    console.log('JollyKite App initialized successfully!');

                    // Expose app to window for debugging
                    window.jollyKiteApp = jollyKiteApp;

                    // –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º
                    window.showCacheInfo = function() {
                        const statsInfo = jollyKiteApp.getStatisticsCacheInfo();

                        console.log('üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ JollyKite:');
                        console.log('');
                        console.log('üå™Ô∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ—Ç—Ä–∞ (–¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤):');
                        console.log(`  - –ó–∞–ø–∏—Å–µ–π: ${statsInfo.entries}`);
                        console.log(`  - –†–∞–∑–º–µ—Ä: ${statsInfo.sizeKB} KB`);
                        console.log(`  - –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è: ${statsInfo.maxHistoryMinutes} –º–∏–Ω—É—Ç`);
                        if (statsInfo.oldestEntry) {
                            console.log(`  - –°—Ç–∞—Ä–µ–π—à–∞—è –∑–∞–ø–∏—Å—å: ${new Date(statsInfo.oldestEntry).toLocaleString('ru-RU')}`);
                            console.log(`  - –ù–æ–≤–µ–π—à–∞—è –∑–∞–ø–∏—Å—å: ${new Date(statsInfo.newestEntry).toLocaleString('ru-RU')}`);
                        }
                        console.log('');
                        console.log('üí° –ö–æ–º–∞–Ω–¥—ã:');
                        console.log('  showCacheInfo() - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é');
                        console.log('  clearAllCache() - –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à');

                        return { statistics: statsInfo };
                    };

                    window.clearAllCache = function() {
                        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à? –í—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                            jollyKiteApp.clearStatisticsCache();
                            console.log('‚úÖ –í–µ—Å—å –∫–µ—à –æ—á–∏—â–µ–Ω');
                        }
                    };

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º –∫–µ—à–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
                    const statsInfo = jollyKiteApp.getStatisticsCacheInfo();
                    if (statsInfo.entries > 0) {
                        console.log(`‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${statsInfo.entries} –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏–∑ –∫–µ—à–∞ (${statsInfo.sizeKB} KB)`);
                        console.log('üí° –í–≤–µ–¥–∏—Ç–µ showCacheInfo() –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏');
                    }

                    // Set up countdown timer
                    updateCountdown();
                    setInterval(updateCountdown, 1000);
                } else {
                    console.error('Failed to initialize JollyKite App');
                }
            } catch (error) {
                console.error('Error initializing app:', error);
            }
        });
        
        // Countdown function
        function updateCountdown() {
            const now = new Date();
            const nextUpdate = new Date(now);
            nextUpdate.setSeconds(nextUpdate.getSeconds() + (30 - (now.getSeconds() % 30)));
            
            const diff = nextUpdate - now;
            const seconds = Math.floor(diff / 1000) % 30;
            
            document.querySelectorAll('.countdown').forEach(element => {
                element.textContent = seconds;
            });
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (jollyKiteApp) {
                jollyKiteApp.destroy();
            }
        });

        // PWA Functionality
        let deferredPrompt;
        let installButton;

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        showUpdateNotification();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // Handle PWA install prompt
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('PWA install prompt triggered');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            showInstallButton();
        });

        // Handle PWA installation
        window.addEventListener('appinstalled', function(evt) {
            console.log('PWA installed successfully');
            hideInstallButton();
            
            // Track installation
            if (window.gtag) {
                gtag('event', 'pwa_install', {
                    event_category: 'PWA',
                    event_label: 'User installed PWA'
                });
            }
        });

        // Show install button
        function showInstallButton() {
            if (!installButton) {
                installButton = document.createElement('button');
                installButton.innerHTML = `
                    <div class="flex items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        <span>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span>
                    </div>
                `;
                installButton.className = 'fixed top-4 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-lg transition-all duration-300 flex items-center gap-2 text-sm font-medium';
                installButton.style.display = 'block';
                
                installButton.addEventListener('click', handleInstall);
                document.body.appendChild(installButton);
                
                // Auto hide after 10 seconds
                setTimeout(() => {
                    if (installButton) {
                        installButton.style.opacity = '0.7';
                    }
                }, 10000);
            }
        }

        // Hide install button
        function hideInstallButton() {
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
        }

        // Handle install button click
        async function handleInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('User accepted PWA installation');
                } else {
                    console.log('User dismissed PWA installation');
                }
                
                deferredPrompt = null;
                hideInstallButton();
            }
        }

        // Show update notification
        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div class="bg-blue-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center justify-between">
                    <span>–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
                    <button id="update-btn" class="bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded text-sm">
                        –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            `;
            notification.className = 'fixed bottom-4 right-4 z-50';
            
            document.body.appendChild(notification);
            
            notification.querySelector('#update-btn').addEventListener('click', () => {
                window.location.reload();
            });
            
            // Auto remove after 10 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
        }

        // Handle offline/online status
        window.addEventListener('online', function() {
            console.log('App is online');
            if (jollyKiteApp) {
                jollyKiteApp.refreshData();
            }
            showOnlineStatus();
        });

        window.addEventListener('offline', function() {
            console.log('App is offline');
            showOfflineStatus();
        });

        function showOnlineStatus() {
            const status = document.createElement('div');
            status.innerHTML = `
                <div class="bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-300 rounded-full animate-pulse"></div>
                    <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</span>
                </div>
            `;
            status.className = 'fixed bottom-4 left-4 z-50';
            
            document.body.appendChild(status);
            
            setTimeout(() => {
                if (status.parentNode) {
                    status.remove();
                }
            }, 3000);
        }

        function showOfflineStatus() {
            const status = document.createElement('div');
            status.innerHTML = `
                <div class="bg-orange-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2">
                    <div class="w-2 h-2 bg-orange-300 rounded-full"></div>
                    <span>–†–∞–±–æ—Ç–∞ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ</span>
                </div>
            `;
            status.className = 'fixed bottom-4 left-4 z-50';
            
            document.body.appendChild(status);
            
            setTimeout(() => {
                if (status.parentNode) {
                    status.remove();
                }
            }, 5000);
        }

        // Check if running as PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches ||
                   window.navigator.standalone ||
                   document.referrer.includes('android-app://');
        }

        // Add PWA-specific styling if running as PWA
        if (isPWA()) {
            document.documentElement.classList.add('pwa-mode');
            console.log('Running as PWA');
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∏
        window.arrowOffsets = {
            globalAngle: 0,  // –û–±—â–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —É–≥–ª–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–µ–ª–æ–∫
            directions: {
                0: { x: -0.0043, y: 0.0006 },     // –°
                45: { x: -0.0033, y: -0.0037 },   // –°–í
                90: { x: -0.0004, y: -0.0041 },   // –í
                135: { x: 0.004, y: -0.0037 },    // –Æ–í
                180: { x: 0.003, y: 0.0011 },     // –Æ
                225: { x: 0.0025, y: 0.0045 },    // –Æ–ó
                270: { x: -0.0006, y: 0.004 },    // –ó
                315: { x: -0.0034, y: 0.004 }     // –°–ó
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–º–µ—â–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∏
        window.applyArrowOffsets = function() {
            // –°—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É —É–≥–ª–∞
            window.arrowOffsets.globalAngle = parseFloat(document.getElementById('globalAngleOffset').value) || 0;

            // –°—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            window.arrowOffsets.directions[0].x = parseFloat(document.getElementById('dir0OffsetX').value) || 0;
            window.arrowOffsets.directions[0].y = parseFloat(document.getElementById('dir0OffsetY').value) || 0;

            window.arrowOffsets.directions[45].x = parseFloat(document.getElementById('dir45OffsetX').value) || 0;
            window.arrowOffsets.directions[45].y = parseFloat(document.getElementById('dir45OffsetY').value) || 0;

            window.arrowOffsets.directions[90].x = parseFloat(document.getElementById('dir90OffsetX').value) || 0;
            window.arrowOffsets.directions[90].y = parseFloat(document.getElementById('dir90OffsetY').value) || 0;

            window.arrowOffsets.directions[135].x = parseFloat(document.getElementById('dir135OffsetX').value) || 0;
            window.arrowOffsets.directions[135].y = parseFloat(document.getElementById('dir135OffsetY').value) || 0;

            window.arrowOffsets.directions[180].x = parseFloat(document.getElementById('dir180OffsetX').value) || 0;
            window.arrowOffsets.directions[180].y = parseFloat(document.getElementById('dir180OffsetY').value) || 0;

            window.arrowOffsets.directions[225].x = parseFloat(document.getElementById('dir225OffsetX').value) || 0;
            window.arrowOffsets.directions[225].y = parseFloat(document.getElementById('dir225OffsetY').value) || 0;

            window.arrowOffsets.directions[270].x = parseFloat(document.getElementById('dir270OffsetX').value) || 0;
            window.arrowOffsets.directions[270].y = parseFloat(document.getElementById('dir270OffsetY').value) || 0;

            window.arrowOffsets.directions[315].x = parseFloat(document.getElementById('dir315OffsetX').value) || 0;
            window.arrowOffsets.directions[315].y = parseFloat(document.getElementById('dir315OffsetY').value) || 0;

            console.log('‚úÖ –°–º–µ—â–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', window.arrowOffsets);

            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
            if (window.app && window.app.windArrowController) {
                window.app.windArrowController.updateArrow();
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Å—à—Ç–∞–±–∞ –∫–∞—Ä—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        window.updateMapScale = function(value) {
            document.getElementById('mapScaleValue').textContent = value;
            applyMapSettingsLive();
        };

        window.updateMapShift = function(value) {
            document.getElementById('mapShiftValue').textContent = value;
            applyMapSettingsLive();
        };

        function applyMapSettingsLive() {
            const scale = document.getElementById('mapScaleInput').value;
            const shift = document.getElementById('mapShiftInput').value;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö)
            if (window.innerWidth <= 768) {
                const mapContainer = document.querySelector('.map-container');
                if (mapContainer) {
                    mapContainer.style.width = scale + '%';
                    mapContainer.style.marginLeft = '-' + shift + '%';
                }
            }
        }

        window.applyMapSettings = function() {
            const scale = document.getElementById('mapScaleInput').value;
            const shift = document.getElementById('mapShiftInput').value;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º CSS –∫–æ–¥
            const cssCode = `@media (max-width: 768px) {
    .map-container {
        margin-left: -${shift}%;
        width: ${scale}%;
    }
}`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥
            const codeDiv = document.getElementById('mapSettingsCode');
            codeDiv.textContent = cssCode;
            codeDiv.style.display = 'block';

            // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            navigator.clipboard.writeText(cssCode).then(() => {
                console.log('‚úÖ CSS –∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                alert('‚úÖ CSS –∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!\n\n–í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å @media (max-width: 768px) –≤ index.html');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                alert('CSS –∫–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é –∏–∑ –ø–æ–ª—è –Ω–∏–∂–µ.');
            });

            console.log('üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö:');
            console.log(`  - –ú–∞—Å—à—Ç–∞–±: ${scale}%`);
            console.log(`  - –°–¥–≤–∏–≥ –≤–ª–µ–≤–æ: ${shift}%`);
            console.log('');
            console.log('CSS –∫–æ–¥:');
            console.log(cssCode);
        };

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', applyMapSettingsLive);
    </script>
</body>
</html>
